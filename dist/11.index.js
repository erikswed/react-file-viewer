(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{24:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=s();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var a=i?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(r,n,a):r[n]=t[n]}r.default=t,e&&e.set(t,r);return r}(r(0)),n=o(r(52)),a=o(r(4));function o(t){return t&&t.__esModule?t:{default:t}}function s(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return s=function(){return t},t}function u(){return(u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}class l extends i.Component{constructor(t){super(t),this.state={error:!1}}componentDidMount(){try{const t=new n.default("xbim-viewer");t.load(this.props.filePath),t.start()}catch(t){this.props.onError&&this.props.onError(t),this.setState({error:t})}}render(){return this.state.error?i.default.createElement(a.default,u({},this.props,{error:this.state.error})):i.default.createElement("div",{className:"pg-driver-view"},i.default.createElement("canvas",{id:"xbim-viewer"}))}}e.default=l},52:function(t,e,r){"use strict";function i(){this._buffer=null,this._position=0}function n(){this.normals=[],this.indices=[],this.products=[],this.transformations=[],this.styleIndices=[],this.states=[],this.vertices=[],this.matrices=[],this.styles=[],this.meter=1e3,this.productMap={}}function a(t,e,r){if(void 0===t||void 0===e||void 0===r)throw"WebGL context and geometry model must be specified";this._gl=t,this._model=e,this._fpt=r,this.id=a._instancesNum++,this.stopped=!1,this.count=e.indices.length,this.vertexTexture=t.createTexture(),this.matrixTexture=t.createTexture(),this.styleTexture=t.createTexture(),this.stateStyleTexture=t.createTexture(),this.vertexTextureSize=0,this.matrixTextureSize=0,this.styleTextureSize=0,this.normalBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.productBuffer=t.createBuffer(),this.styleBuffer=t.createBuffer(),this.stateBuffer=t.createBuffer(),this.transformationBuffer=t.createBuffer(),this.stateStyle=new Uint8Array(900),this._feedCompleted=!1,this.region=e.regions[0],e.regions.forEach((function(t){t.population>this.region.population&&(this.region=t)}),this),void 0===this.region&&(this.region={population:1,centre:[0,0,0],bbox:[0,0,0,10*e.meter,10*e.meter,10*e.meter]})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i.prototype.onloaded=function(){},i.prototype.onerror=function(){},i.prototype.load=function(t){this._position=0;var e,r=this;if(void 0===t||null==t)throw"Source must be defined";if("string"==typeof t)(e=new XMLHttpRequest).open("GET",t,!0),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var t=new FileReader;t.onloadend=function(){t.result&&(r._buffer=t.result,r.onloaded&&r.onloaded())},t.readAsArrayBuffer(e.response)}if(4==e.readyState&&200!=e.status){var i="Failed to fetch binary data from server. Server code: "+e.status+". This might be due to CORS policy of your browser if you run this as a local file.";throw r.onerror&&r.onerror(i),i}},e.responseType="blob",e.send();else if(t instanceof Blob||t instanceof File){var i=new FileReader;i.onloadend=function(){i.result&&(r._buffer=i.result,r.onloaded&&r.onloaded())},i.readAsArrayBuffer(t)}else t instanceof ArrayBuffer&&(this._buffer=t)},i.prototype.getIsEOF=function(t,e){if(void 0===this._position)throw"Position is not defined";return this._position==this._buffer.byteLength},i.prototype.read=function(t,e,r){void 0===e&&(e=1);var i=t*e,n=this._position;return this._position+=i,1===e?new r(this._buffer.slice(n,n+i))[0]:new r(this._buffer.slice(n,n+i))},i.prototype.readByte=function(t){return this.read(1,t,Uint8Array)},i.prototype.readUint8=function(t){return this.read(1,t,Uint8Array)},i.prototype.readInt16=function(t){return this.read(2,t,Int16Array)},i.prototype.readUint16=function(t){return this.read(2,t,Uint16Array)},i.prototype.readInt32=function(t){return this.read(4,t,Int32Array)},i.prototype.readUint32=function(t){return this.read(4,t,Uint32Array)},i.prototype.readFloat32=function(t){return this.read(4,t,Float32Array)},i.prototype.readFloat64=function(t){return this.read(8,t,Float64Array)},i.prototype.readChar=function(t){void 0===t&&(t=1);var e=this.readByte(t),r=new Array(t);for(var i in e)r[i]=String.fromCharCode(e[i]);return 1===t?r[0]:r},i.prototype.readPoint=function(t){void 0===t&&(t=1);for(var e=this.readFloat32(3*t),r=new Array(t),i=0;i<t;i++){var n=3*i*4,a=new Float32Array(e.buffer,n,3);r[i]=a}return 1===t?r[0]:r},i.prototype.readRgba=function(t){void 0===t&&(t=1);for(var e=this.readByte(4*t),r=new Array(t),i=0;i<t;i++){var n=4*i,a=new Uint8Array(e.buffer,n,4);r[i]=a}return 1===t?r[0]:r},i.prototype.readPackedNormal=function(t){void 0===t&&(t=1);for(var e=this.readUint8(2*t),r=new Array(t),i=0;i<t;i++){var n=new Uint8Array(e.buffer,2*i,2);r[i]=n}return 1===t?r[0]:r},i.prototype.readMatrix4x4=function(t){void 0===t&&(t=1);for(var e=this.readFloat32(16*t),r=new Array(t),i=0;i<t;i++){var n=16*i*4,a=new Float32Array(e.buffer,n,16);r[i]=a}return 1===t?r[0]:r},i.prototype.readMatrix4x4_64=function(t){void 0===t&&(t=1);for(var e=this.readFloat64(16*t),r=new Array(t),i=0;i<t;i++){var n=16*i*8,a=new Float64Array(e.buffer,n,16);r[i]=a}return 1===t?r[0]:r},n.prototype.parse=function(t){var e=t;if(94132117!=e.readInt32())throw"Magic number mismatch.";var r=e.readByte(),i=e.readInt32(),n=e.readInt32(),a=e.readInt32(),l=e.readInt32(),h=e.readInt32(),c=e.readInt32();this.meter=e.readFloat32();var f=e.readInt16(),d=function(t,e){if(void 0===t||void 0===e)throw"Wrong arguments";if(0==e)return 0;for(var r=e*t,i=Math.ceil(Math.sqrt(r/4));4*i%t!=0;)i++;return i*i*4/t};this.vertices=new Float32Array(d(4,3*n)),this.normals=new Uint8Array(6*a),this.indices=new Float32Array(3*a),this.styleIndices=new Uint16Array(3*a),this.styles=new Uint8Array(d(1,4*(c+1))),this.products=new Float32Array(3*a),this.states=new Uint8Array(3*a*2),this.transformations=new Float32Array(3*a),this.matrices=new Float32Array(d(4,16*l)),this.productMap={},this.regions=new Array(f);for(var m=0,v=0,p=3*a,g=0,E=0,I=s,x=o,C=0;C<f;C++)this.regions[C]={population:e.readInt32(),centre:e.readFloat32(3),bbox:e.readFloat32(6)};var T=[];T.getStyle=function(t){for(var e=0;e<this.length;e++){var r=this[e];if(r.id==t)return r}return null};for(var _=0;_<c;_++){var A=e.readInt32(),M=255*e.readFloat32(),y=255*e.readFloat32(),F=255*e.readFloat32(),S=255*e.readFloat32();this.styles.set([M,y,F,S],4*_),T.push({id:A,index:_,transparent:S<254})}this.styles.set([255,255,255,255],4*_);var R={id:-1,index:_,transparent:S<254};T.push(R);for(C=0;C<h;C++){var b=e.readInt32(),P={productID:b,type:e.readInt16(),bBox:e.readFloat32(6),spans:[]};this.productMap[b]=P}for(var w=0;w<i;w++){for(var N=e.readInt32(),L=[],U=0;U<N;U++){var B=e.readInt32(),D=(e.readInt16(),e.readInt32()),O=(A=e.readInt32(),null);N>1&&(O=1===r?e.readFloat32(16):e.readFloat64(16),this.matrices.set(O,E),E+=16);var z=T.getStyle(A);null===z&&(z=R),L.push({pLabel:B,iLabel:D,style:z.index,transparent:z.transparent,transform:null!=O?g++:65535})}var G=new u;G.parse(e),L.forEach((function(t){var e=0,r=e=t.transparent?p-G.indices.length:v,i=this.productMap[t.pLabel];void 0===i&&(i={productID:0,type:x.IFCOPENINGELEMENT,bBox:new Float32Array(6),spans:[]},this.productMap[t.pLabel]=i),this.normals.set(G.normals,2*e);for(var n=i.type==x.IFCSPACE||i.type==x.IFCOPENINGELEMENT?I.HIDDEN:255,a=0;a<G.indices.length;a++)this.indices[e]=G.indices[a]+m/3,this.products[e]=t.pLabel,this.styleIndices[e]=t.style,this.transformations[e]=t.transform,this.states[2*e]=n,this.states[2*e+1]=255,e++;var o=e;i.spans.push(new Int32Array([r,o])),t.transparent?p-=G.indices.length:v+=G.indices.length}),this),this.vertices.set(G.vertices,m),m+=G.vertices.length,G=null}e.getIsEOF(),this.transparentIndex=v},n.prototype.load=function(t){var e=new i,r=this;e.onloaded=function(){r.parse(e),r.onloaded&&r.onloaded()},e.onerror=function(t){r.onerror&&r.onerror(t)},e.load(t)},n.prototype.onloaded=function(){},n.prototype.onerror=function(){},a._instancesNum=0,a.prototype.setActive=function(t){if(!this.stopped){var e=this._gl;this.vertexTextureSize>0&&(e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.vertexTexture)),this.matrixTextureSize>0&&(e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.matrixTexture)),this.styleTextureSize>0&&(e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,this.styleTexture)),e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.stateStyleTexture),e.bindBuffer(e.ARRAY_BUFFER,this.normalBuffer),e.vertexAttribPointer(t.normalAttrPointer,2,e.UNSIGNED_BYTE,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.indexBuffer),e.vertexAttribPointer(t.indexlAttrPointer,1,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.productBuffer),e.vertexAttribPointer(t.productAttrPointer,1,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.stateBuffer),e.vertexAttribPointer(t.stateAttrPointer,2,e.UNSIGNED_BYTE,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.styleBuffer),e.vertexAttribPointer(t.styleAttrPointer,1,e.UNSIGNED_SHORT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.transformationBuffer),e.vertexAttribPointer(t.transformationAttrPointer,1,e.FLOAT,!1,0,0),e.uniform1i(t.vertexSamplerUniform,1),e.uniform1i(t.matrixSamplerUniform,2),e.uniform1i(t.styleSamplerUniform,3),e.uniform1i(t.stateStyleSamplerUniform,4),e.uniform1i(t.vertexTextureSizeUniform,this.vertexTextureSize),e.uniform1i(t.matrixTextureSizeUniform,this.matrixTextureSize),e.uniform1i(t.styleTextureSizeUniform,this.styleTextureSize)}},a.prototype.draw=function(t){if(!this.stopped){var e=this._gl;void 0!==t?"solid"!==t?"transparent"!==t||e.drawArrays(e.TRIANGLES,this._model.transparentIndex,this.count-this._model.transparentIndex):e.drawArrays(e.TRIANGLES,0,this._model.transparentIndex):e.drawArrays(e.TRIANGLES,0,this.count)}},a.prototype.drawProduct=function(t){if(!this.stopped){var e=this._gl,r=this.getProductMap(t);null!=r&&r.spans.forEach((function(t){e.drawArrays(e.TRIANGLES,t[0],t[1]-t[0])}),this)}},a.prototype.getProductMap=function(t){var e=this._model.productMap[t];return void 0!==e?e:null},a.prototype.unload=function(){var t=this._gl;t.deleteTexture(this.vertexTexture),t.deleteTexture(this.matrixTexture),t.deleteTexture(this.styleTexture),t.deleteTexture(this.stateStyleTexture),t.deleteBuffer(this.normalBuffer),t.deleteBuffer(this.indexBuffer),t.deleteBuffer(this.productBuffer),t.deleteBuffer(this.styleBuffer),t.deleteBuffer(this.stateBuffer),t.deleteBuffer(this.transformationBuffer)},a.prototype.feedGPU=function(){if(this._feedCompleted)throw"GPU can bee fed only once. It discards unnecessary data which cannot be restored again.";this._gl;var t=this._model;this._bufferData(this.normalBuffer,t.normals),this._bufferData(this.indexBuffer,t.indices),this._bufferData(this.productBuffer,t.products),this._bufferData(this.stateBuffer,t.states),this._bufferData(this.transformationBuffer,t.transformations),this._bufferData(this.styleBuffer,t.styleIndices),this.vertexTextureSize=this._bufferTexture(this.vertexTexture,t.vertices,3),this.matrixTextureSize=this._bufferTexture(this.matrixTexture,t.matrices,4),this.styleTextureSize=this._bufferTexture(this.styleTexture,t.styles),this._bufferTexture(this.stateStyleTexture,this.stateStyle),t.normals=null,t.indices=null,t.products=null,t.transformations=null,t.styleIndices=null,t.vertices=null,t.matrices=null,this._feedCompleted=!0},a.prototype.refreshStyles=function(){this._bufferTexture(this.stateStyleTexture,this.stateStyle)},a.prototype._bufferData=function(t,e){var r=this._gl;r.bindBuffer(r.ARRAY_BUFFER,t),r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)},a.prototype._bufferTexture=function(t,e,r){var i=this._gl;if(0==e.length)return 0;var n=this._fpt&&e instanceof Float32Array,a=0,o=i.getParameter(i.MAX_TEXTURE_SIZE);if(n)a=Math.ceil(Math.sqrt(Math.ceil(e.length/r)))+1;else{var s=Math.sqrt(e.byteLength/4);a=Math.ceil(s)}if(0==a)return 0;if(a>o)throw"Too much data! It cannot fit into the texture.";if(i.bindTexture(i.TEXTURE_2D,t),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,0),n){var u=null;a*a*r!=e.length?(u=new Float32Array(a*a*r)).set(e):u=e;var l=null;switch(r){case 1:l=i.ALPHA;break;case 3:l=i.RGB;break;case 4:l=i.RGBA}i.texImage2D(i.TEXTURE_2D,0,l,a,a,0,l,i.FLOAT,u)}else i.texImage2D(i.TEXTURE_2D,0,i.RGBA,a,a,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array(e.buffer));return i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),a},a.prototype.getState=function(t){if(void 0===t)throw"id must be defined";var e=this.getProductMap(t);if(null===e)return null;var r=e.spans[0];return void 0===r?null:this._model.states[2*r[0]]},a.prototype.getStyle=function(t){if(void 0===t)throw"id must be defined";var e=this.getProductMap(t);if(null===e)return null;var r=e.spans[0];return void 0===r?null:this._model.states[2*r[0]+1]},a.prototype.setState=function(t,e){if("number"!=typeof t&&t<0&&t>255)throw"You have to specify state as an ID of state or index in style pallete.";if(void 0===e)throw"You have to specify products as an array of product IDs or as a product type ID";var r=[];if("number"==typeof e)for(var i in this._model.productMap){(a=this._model.productMap[i]).type==e&&r.push(a)}else for(var n=0;n<e.length;n++){var a,o=e[n];null!=(a=this.getProductMap(o))&&r.push(a)}var s=t<=225?1:0;r.forEach((function(e){e.spans.forEach((function(e){for(var r=e[0];r<e[1];r++)this._model.states[2*r+s]=t}),this)}),this),this._bufferData(this.stateBuffer,this._model.states)},a.prototype.resetStates=function(){for(var t=0;t<this._model.states.length;t+=2)this._model.states[t]=s.UNDEFINED;this._bufferData(this.stateBuffer,this._model.states)},a.prototype.resetStyles=function(){for(var t=0;t<this._model.states.length;t+=2)this._model.states[t+1]=s.UNSTYLED;this._bufferData(this.stateBuffer,this._model.states)},a.prototype.getModelState=function(){var t=[],e=this._model.productMap;for(var r in e)if(e.hasOwnProperty(r)){var i=e[r],n=i.spans[0];if(void 0!==n){var a=this._model.states[2*n[0]],o=this._model.states[2*n[0]+1];t.push([i.productID,a+(o<<8)])}}return t},a.prototype.restoreModelState=function(t){t.forEach((function(t){var e=t[0],r=t[1]>>8,i=t[1]-(r<<8),n=this.getProductMap(e);null!=n&&n.spans.forEach((function(t){for(var e=t[0];e<t[1];e++)this._model.states[2*e]=i,this._model.states[2*e+1]=r}),this)}),this),this._bufferData(this.stateBuffer,this._model.states)};var o={IFCDISTRIBUTIONELEMENT:44,IFCDISTRIBUTIONFLOWELEMENT:45,IFCDISTRIBUTIONCHAMBERELEMENT:180,IFCENERGYCONVERSIONDEVICE:175,IFCAIRTOAIRHEATRECOVERY:1097,IFCBOILER:1105,IFCBURNER:1109,IFCCHILLER:1119,IFCCOIL:1124,IFCCONDENSER:1132,IFCCOOLEDBEAM:1141,IFCCOOLINGTOWER:1142,IFCENGINE:1164,IFCEVAPORATIVECOOLER:1166,IFCEVAPORATOR:1167,IFCHEATEXCHANGER:1187,IFCHUMIDIFIER:1188,IFCTUBEBUNDLE:1305,IFCUNITARYEQUIPMENT:1310,IFCELECTRICGENERATOR:1160,IFCELECTRICMOTOR:1161,IFCMOTORCONNECTION:1216,IFCSOLARDEVICE:1270,IFCTRANSFORMER:1303,IFCFLOWCONTROLLER:121,IFCELECTRICDISTRIBUTIONPOINT:242,IFCAIRTERMINALBOX:1096,IFCDAMPER:1148,IFCFLOWMETER:1182,IFCVALVE:1311,IFCELECTRICDISTRIBUTIONBOARD:1157,IFCELECTRICTIMECONTROL:1162,IFCPROTECTIVEDEVICE:1235,IFCSWITCHINGDEVICE:1290,IFCFLOWFITTING:467,IFCDUCTFITTING:1153,IFCPIPEFITTING:1222,IFCCABLECARRIERFITTING:1111,IFCCABLEFITTING:1113,IFCJUNCTIONBOX:1195,IFCFLOWMOVINGDEVICE:502,IFCCOMPRESSOR:1131,IFCFAN:1177,IFCPUMP:1238,IFCFLOWSEGMENT:574,IFCDUCTSEGMENT:1154,IFCPIPESEGMENT:1223,IFCCABLECARRIERSEGMENT:1112,IFCCABLESEGMENT:1115,IFCFLOWSTORAGEDEVICE:371,IFCTANK:1293,IFCELECTRICFLOWSTORAGEDEVICE:1159,IFCFLOWTERMINAL:46,IFCFIRESUPPRESSIONTERMINAL:1179,IFCSANITARYTERMINAL:1262,IFCSTACKTERMINAL:1277,IFCWASTETERMINAL:1315,IFCAIRTERMINAL:1095,IFCMEDICALDEVICE:1212,IFCSPACEHEATER:1272,IFCAUDIOVISUALAPPLIANCE:1099,IFCCOMMUNICATIONSAPPLIANCE:1127,IFCELECTRICAPPLIANCE:1156,IFCLAMP:1198,IFCLIGHTFIXTURE:1199,IFCOUTLET:1219,IFCFLOWTREATMENTDEVICE:425,IFCINTERCEPTOR:1193,IFCDUCTSILENCER:1155,IFCFILTER:1178,IFCDISTRIBUTIONCONTROLELEMENT:468,IFCPROTECTIVEDEVICETRIPPINGUNIT:1236,IFCACTUATOR:1091,IFCALARM:1098,IFCCONTROLLER:1139,IFCFLOWINSTRUMENT:1181,IFCSENSOR:1264,IFCUNITARYCONTROLELEMENT:1308,IFCDISCRETEACCESSORY:423,IFCFASTENER:535,IFCMECHANICALFASTENER:536,IFCREINFORCINGBAR:571,IFCREINFORCINGMESH:531,IFCTENDON:261,IFCTENDONANCHOR:675,IFCBUILDINGELEMENTPART:220,IFCMECHANICALFASTENER:536,IFCVIBRATIONISOLATOR:1312,IFCCHAMFEREDGEFEATURE:765,IFCROUNDEDEDGEFEATURE:766,IFCOPENINGELEMENT:498,IFCOPENINGSTANDARDCASE:1217,IFCVOIDINGFEATURE:1313,IFCPROJECTIONELEMENT:384,IFCSURFACEFEATURE:1287,IFCBUILDINGELEMENTPART:220,IFCREINFORCINGBAR:571,IFCREINFORCINGMESH:531,IFCTENDON:261,IFCTENDONANCHOR:675,IFCFOOTING:120,IFCPILE:572,IFCBEAM:171,IFCBEAMSTANDARDCASE:1104,IFCCOLUMN:383,IFCCOLUMNSTANDARDCASE:1126,IFCCURTAINWALL:456,IFCDOOR:213,IFCDOORSTANDARDCASE:1151,IFCMEMBER:310,IFCMEMBERSTANDARDCASE:1214,IFCPLATE:351,IFCPLATESTANDARDCASE:1224,IFCRAILING:350,IFCRAMP:414,IFCRAMPFLIGHT:348,IFCROOF:347,IFCSLAB:99,IFCSLABELEMENTEDCASE:1268,IFCSLABSTANDARDCASE:1269,IFCSTAIR:346,IFCSTAIRFLIGHT:25,IFCWALL:452,IFCWALLSTANDARDCASE:453,IFCWALLELEMENTEDCASE:1314,IFCWINDOW:667,IFCWINDOWSTANDARDCASE:1316,IFCBUILDINGELEMENTPROXY:560,IFCCOVERING:382,IFCCHIMNEY:1120,IFCSHADINGDEVICE:1265,IFCELEMENTASSEMBLY:18,IFCFURNISHINGELEMENT:253,IFCFURNITURE:1184,IFCSYSTEMFURNITUREELEMENT:1291,IFCTRANSPORTELEMENT:416,IFCVIRTUALELEMENT:168,IFCELECTRICALELEMENT:23,IFCEQUIPMENTELEMENT:212,IFCCIVILELEMENT:1122,IFCGEOGRAPHICELEMENT:1185,IFCDISTRIBUTIONPORT:178,IFCPROXY:447,IFCSTRUCTURALLINEARACTION:463,IFCSTRUCTURALLINEARACTIONVARYING:464,IFCSTRUCTURALPLANARACTION:39,IFCSTRUCTURALPLANARACTIONVARYING:357,IFCSTRUCTURALPOINTACTION:356,IFCSTRUCTURALCURVEACTION:1279,IFCSTRUCTURALLINEARACTION:463,IFCSTRUCTURALSURFACEACTION:1284,IFCSTRUCTURALPLANARACTION:39,IFCSTRUCTURALPOINTREACTION:354,IFCSTRUCTURALCURVEREACTION:1280,IFCSTRUCTURALSURFACEREACTION:1285,IFCSTRUCTURALCURVECONNECTION:534,IFCSTRUCTURALPOINTCONNECTION:533,IFCSTRUCTURALSURFACECONNECTION:264,IFCSTRUCTURALCURVEMEMBER:224,IFCSTRUCTURALCURVEMEMBERVARYING:227,IFCSTRUCTURALSURFACEMEMBER:420,IFCSTRUCTURALSURFACEMEMBERVARYING:421,IFCANNOTATION:634,IFCBUILDING:169,IFCBUILDINGSTOREY:459,IFCSITE:349,IFCSPACE:454,IFCGRID:564,IFCBUILDING:169,IFCBUILDINGSTOREY:459,IFCSITE:349,IFCSPACE:454,IFCEXTERNALSPATIALELEMENT:1174,IFCSPATIALZONE:1275};window.xShaders||(window.xShaders={}),xShaders.fragment_shader=" precision mediump float; uniform vec4 uClippingPlane; varying vec4 vFrontColor; varying vec4 vBackColor; varying vec3 vPosition; varying float vDiscard; void main(void) { if ( vDiscard > 0.001) discard; if (length(uClippingPlane) > 0.001) { vec4 p = uClippingPlane; vec3 x = vPosition; float distance = (dot(p.xyz, x) + p.w) / length(p.xyz); if (distance < 0.0){ discard; } } gl_FragColor = gl_FrontFacing ? vFrontColor : vBackColor; }",xShaders.vertex_shader=" attribute highp float aVertexIndex; attribute highp float aTransformationIndex; attribute highp float aStyleIndex; attribute highp float aProduct; attribute highp vec2 aState; attribute highp vec2 aNormal; uniform mat4 uMVMatrix; uniform mat4 uPMatrix; uniform vec4 ulightA; uniform vec4 ulightB; uniform vec4 uHighlightColour; uniform float uMeter; uniform bool uColorCoding; uniform int uRenderingMode; uniform highp sampler2D uVertexSampler; uniform int uVertexTextureSize; uniform highp sampler2D uMatrixSampler; uniform int uMatrixTextureSize; uniform highp sampler2D uStyleSampler; uniform int uStyleTextureSize; uniform highp sampler2D uStateStyleSampler; varying vec4 vFrontColor; varying vec4 vBackColor; varying vec3 vPosition; varying float vDiscard; vec3 getNormal(){ float U = aNormal[0]; float V = aNormal[1]; float PI = 3.1415926535897932384626433832795; float lon = U / 252.0 * 2.0 * PI; float lat = V / 252.0 * PI; float x = sin(lon) * sin(lat); float z = cos(lon) * sin(lat); float y = cos(lat); return normalize(vec3(x, y, z)); } vec4 getIdColor(){ float product = floor(aProduct + 0.5); float B = floor (product/(256.0*256.0)); float G = floor((product  - B * 256.0*256.0)/256.0); float R = mod(product, 256.0); return vec4(R/255.0, G/255.0, B/255.0, 1.0); } vec2 getTextureCoordinates(int index, int size) { float x = float(index - (index / size) * size); float y = float(index / size); float pixelSize = 1.0 / float(size); return vec2((x + 0.5) * pixelSize, (y + 0.5) * pixelSize); } vec4 getColor(){ int restyle = int(floor(aState[1] + 0.5)); if (restyle > 224){ int index = int (floor(aStyleIndex + 0.5)); vec2 coords = getTextureCoordinates(index, uStyleTextureSize); return texture2D(uStyleSampler, coords); } vec2 coords = getTextureCoordinates(restyle, 15); return texture2D(uStateStyleSampler, coords); } vec3 getVertexPosition(){ int index = int (floor(aVertexIndex +0.5)); vec2 coords = getTextureCoordinates(index, uVertexTextureSize); vec3 point = vec3(texture2D(uVertexSampler, coords)); int tIndex = int(floor(aTransformationIndex + 0.5)); if (tIndex != 65535) { tIndex *=4; mat4 transform = mat4( texture2D(uMatrixSampler, getTextureCoordinates(tIndex, uMatrixTextureSize)), texture2D(uMatrixSampler, getTextureCoordinates(tIndex+1, uMatrixTextureSize)), texture2D(uMatrixSampler, getTextureCoordinates(tIndex+2, uMatrixTextureSize)), texture2D(uMatrixSampler, getTextureCoordinates(tIndex+3, uMatrixTextureSize)) ); return vec3(transform * vec4(point, 1.0)); } return point; } void main(void) { int state = int(floor(aState[0] + 0.5)); vDiscard = 0.0; if (state == 254) { vDiscard = 1.0; vFrontColor = vec4(0.0, 0.0, 0.0, 0.0); vBackColor = vec4(0.0, 0.0, 0.0, 0.0); vPosition = vec3(0.0, 0.0, 0.0); gl_Position = vec4(0.0, 0.0, 0.0, 1.0); return; } vec3 vertex = getVertexPosition(); vec3 normal = getNormal(); vec3 backNormal = normal * -1.0; if (uColorCoding){ vec4 idColor = getIdColor(); vFrontColor = idColor; vBackColor = idColor; } else{ float lightAIntensity = ulightA[3]; vec3 lightADirection = normalize(ulightA.xyz - vertex); float lightBIntensity = ulightB[3]; vec3 lightBDirection = normalize(ulightB.xyz - vertex); float lightWeightA = max(dot(normal, lightADirection ) * lightAIntensity, 0.0); float lightWeightB = max(dot(normal, lightBDirection ) * lightBIntensity, 0.0); float backLightWeightA = max(dot(backNormal, lightADirection) * lightAIntensity, 0.0); float backLightWeightB = max(dot(backNormal, lightBDirection) * lightBIntensity, 0.0); float lightWeighting = lightWeightA + lightWeightB + 0.4; float backLightWeighting = backLightWeightA + backLightWeightB + 0.4; vec4 baseColor = vec4(1.0, 1.0, 1.0, 1.0); if (uRenderingMode == 2){ if (state == 252){ baseColor = getColor(); } else{ baseColor = vec4(0.0, 0.0, 0.3, 0.5); } } if (state == 253) { baseColor = uHighlightColour; } if (uRenderingMode != 2 && state != 253){ baseColor = getColor(); } if (baseColor.a < 0.98 && uRenderingMode == 0) { vec3 trans = -0.002 * uMeter * normalize(normal); vertex = vertex + trans; } vFrontColor = vec4(baseColor.rgb * lightWeighting, baseColor.a); vBackColor = vec4(baseColor.rgb * backLightWeighting, baseColor.a); } vPosition = vertex; gl_Position = uPMatrix * uMVMatrix * vec4(vertex, 1.0); }",xShaders.vertex_shader_noFPT=" attribute highp float aVertexIndex; attribute highp float aTransformationIndex; attribute highp float aStyleIndex; attribute highp float aProduct; attribute highp float aState; attribute highp vec2 aNormal; uniform mat4 uMVMatrix; uniform mat4 uPMatrix; uniform vec4 ulightA; uniform vec4 ulightB; uniform bool uColorCoding; uniform bool uFloatingPoint; uniform highp sampler2D uVertexSampler; uniform int uVertexTextureSize; uniform highp sampler2D uMatrixSampler; uniform int uMatrixTextureSize; uniform highp sampler2D uStyleSampler; uniform int uStyleTextureSize; uniform highp sampler2D uStateStyleSampler; int stateStyleTextureSize = 15; varying vec4 vColor; varying vec3 vPosition; vec3 getNormal(){ float U = aNormal[0]; float V = aNormal[1]; float PI = 3.1415926535897932384626433832795; float u = ((U / 252.0) * (2.0 * PI)) - PI; float v = ((V / 252.0) * (2.0 * PI)) - PI; float x = sin(v) * cos(u); float y = sin(v) * sin(u); float z = cos(v); return normalize(vec3(x, y, z)); } vec4 getIdColor(){ float R = mod(aProduct, 256.0) / 255.0; float G = floor(aProduct/256.0) / 255.0; float B = floor (aProduct/(256.0*256.0)) / 255.0; return vec4(R, G, B, 1.0); } vec2 getVertexTextureCoordinates(int index, int size) { float x = float(index - (index / size) * size); float y = float(index / size); float pixelSize = 1.0 / float(size); return vec2((x + 0.5) * pixelSize, (y + 0.5) * pixelSize); } int getByteFromScale(float base) { float result = base * 255.0; int correction = fract(result) >= 0.5 ? 1 : 0; return int(result) + correction; } ivec4 getPixel(int index, sampler2D sampler, int size) { vec2 coords = getVertexTextureCoordinates(index, size); vec4 pixel = texture2D(sampler, coords); return ivec4( getByteFromScale(pixel.r), getByteFromScale(pixel.g), getByteFromScale(pixel.b), getByteFromScale(pixel.a) ); } void getBits(ivec4 pixel, out int result[32]) { for (int i = 0; i < 4; i++) { int actualByte = pixel[i]; for (int j = 0; j < 8; j++) { result[31 - (j + i * 8)] =  actualByte - (actualByte / 2) * 2; actualByte /= 2; } } } float getFloatFromPixel(ivec4 pixel) { int bits[32]; getBits(pixel, bits); float sign =  bits[0] == 0 ? 1.0 : -1.0; highp float fraction = 1.0; highp float exponent = 0.0; for (int i = 1; i < 9; i++) { exponent += float(bits[9 - i]) * exp2(float (i - 1)); } exponent -= 127.0; for (int i = 9; i < 32; i++) { fraction += float(bits[i]) * exp2(float((-1)*(i-8))); } return sign * fraction * exp2(exponent); } float getFloatFromPixel(int index, sampler2D sampler, int size) { ivec4 pixel = getPixel(index, sampler, size); return getFloatFromPixel(pixel); } vec4 getColor(){ if (floor(aState + 0.5) == 0.0){ int index = int (floor(aStyleIndex + 0.5)); vec2 coords = getVertexTextureCoordinates(index, uStyleTextureSize); return texture2D(uStyleSampler, coords); } else{ return vec4(1.0,1.0,1.0,1.0); } } vec3 getVertexPosition(){ int index = int (floor(aVertexIndex +0.5))* 3; vec3 position = vec3( getFloatFromPixel(index, uVertexSampler, uVertexTextureSize), getFloatFromPixel(index + 1, uVertexSampler, uVertexTextureSize), getFloatFromPixel(index + 2, uVertexSampler, uVertexTextureSize) ); int tIndex = int(floor(aTransformationIndex + 0.5)); if (tIndex != 65535) { tIndex *= 16; mat4 transform = mat4( getFloatFromPixel(tIndex + 0, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 1, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 2, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 3, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 4, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 5, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 6, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 7, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 8, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 9, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 10, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 11, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 12, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 13, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 14, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 15, uMatrixSampler, uMatrixTextureSize) ); vec4 transformedPosition = transform * vec4(position, 1.0); return vec3(transformedPosition); } return position; } void main(void) { vec3 vertex = getVertexPosition(); vPosition = vertex; gl_Position = uPMatrix * uMVMatrix * vec4(vertex, 1.0); if (uColorCoding){ vColor = getIdColor(); } else{ vec3 normal = getNormal(); float lightAIntensity = ulightA[3]; vec3 lightADirection = normalize(ulightA.xyz - vPosition); float lightBIntensity = ulightB[3]; vec3 lightBDirection = normalize(ulightB.xyz - vPosition); float lightWeightA = max(dot(normal, lightADirection ) * lightAIntensity, 0.0); float lightWeightB = max(dot(normal, lightBDirection ) * lightBIntensity, 0.0); float lightWeighting = lightWeightA + lightWeightB + 0.4; vec4 baseColor = getColor(); vColor = vec4(baseColor.rgb * lightWeighting, baseColor.a); } }";var s={UNDEFINED:255,HIDDEN:254,HIGHLIGHTED:253,XRAYVISIBLE:252,UNSTYLED:225};function u(){}function l(t){if(void 0===t)throw"Canvas has to be defined";if(this._canvas=null,void 0!==t.nodeName&&"CANVAS"==t.nodeName&&(this._canvas=t),"string"==typeof t&&(this._canvas=document.getElementById(t)),null==this._canvas)throw"You have to specify canvas either as an ID of HTML element or the element itself";this.perspectiveCamera={fov:45,near:0,far:0},this.orthogonalCamera={left:0,right:0,top:0,bottom:0,near:0,far:0},this.camera="perspective",this.background=[230,230,230,255],this.highlightingColour=[255,173,33,255],this.lightA=[0,1e6,2e5,.8],this.lightB=[0,-5e5,5e4,.2],this.navigationMode="orbit",this.renderingMode="normal",this.clippingPlane=[0,0,0,0],this._lastClippingPoint=[0,0,0];var e=d.setupWebGL(this._canvas);e&&(this._gl=e,this._fpt=e.getExtension("OES_texture_float")||e.getExtension("MOZ_OES_texture_float")||e.getExtension("WEBKIT_OES_texture_float"),e.enable(e.DEPTH_TEST),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND),this._width=this._canvas.width=this._canvas.offsetWidth,this._height=this._canvas.height=this._canvas.offsetHeight,this._geometryLoaded=!1,this._numberOfActiveModels=0,this._lastStates={},this._visualStateAttributes=["perspectiveCamera","orthogonalCamera","camera","background","lightA","lightB","renderingMode","clippingPlane","_mvMatrix","_pMatrix","_distance","_origin","highlightingColour","_numberOfActiveModels"],this._stylingChanged=!0,this._userAction=!0,this._events={},this._plugins=[],this._mvMatrixUniformPointer=null,this._pMatrixUniformPointer=null,this._lightAUniformPointer=null,this._lightBUniformPointer=null,this._colorCodingUniformPointer=null,this._clippingPlaneUniformPointer=null,this._meterUniformPointer=null,this._renderingModeUniformPointer=null,this._highlightingColourUniformPointer=null,this._mvMatrix=mat4.create(),this._pMatrix=mat4.create(),this._origin=[0,0,0],this._distance=0,this._shaderProgram=null,this._handles=[],this._stateStyles=new Uint8Array(900),this._isRunning=!0,this._initShaders(),this._initAttributesAndUniforms(),this._initMouseEvents())}u.prototype.parse=function(t){t.readByte();var e=t.readInt32(),r=t.readInt32();this.vertices=t.readFloat32(3*e),this.indices=new Uint32Array(3*r),this.normals=new Uint8Array(6*r);var i,n=0;i=e<=255?function(e){return t.readByte(e)}:e<=65535?function(e){return t.readUint16(e)}:function(e){return t.readInt32(e)};var a=t.readInt32();if(0!==e&&0!==r)for(var o=0;o<a;o++){var s=t.readInt32();if(0!=s){var u=s>0;if(s=Math.abs(s),u){var l=t.readByte(2),h=i(3*s);this.indices.set(h,n);for(var c=0;c<3*s;c++)this.normals[2*n]=l[0],this.normals[2*n+1]=l[1],n++}else for(c=0;c<s;c++)this.indices[n]=i(),this.normals.set(t.readByte(2),2*n),n++,this.indices[n]=i(),this.normals.set(t.readByte(2),2*n),n++,this.indices[n]=i(),this.normals.set(t.readByte(2),2*n),n++}}},u.prototype.load=function(t){var e=new i,r=this;e.onloaded=function(){r.parse(e),r.onloaded&&r.onloaded()},e.load(t)},u.prototype.vertices=[],u.prototype.indices=[],u.prototype.normals=[],u.prototype.onloaded=function(){},l.check=function(){var t={warnings:[],errors:[],noErrors:!1,noWarnings:!1},e=document.createElement("canvas");if(e){var r=d.setupWebGL(e);if(null==r)t.errors.push("Browser doesn't support WebGL. This is critical.");else{r.getExtension("OES_texture_float")||r.getExtension("MOZ_OES_texture_float")||r.getExtension("WEBKIT_OES_texture_float")||t.warnings.push("Floating point texture extension is not supported. Performance of the viewer will be very bad. But it should work.");var i=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS);i<4&&t.errors.push("Browser supports only "+i+" vertex texture image units but minimal requirement for the viewer is 4.")}}else t.errors.push("Browser doesn't have support for HTMLCanvasElement. This is critical.");return window.File&&window.FileReader&&window.Blob||t.errors.push("Browser doesn't support 'File', 'FileReader' or 'Blob' objects."),window.Int32Array&&window.Float32Array||t.errors.push("Browser doesn't support TypedArrays. These are crucial for binary parsing and for comunication with GPU."),document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")||t.warnings.push("Browser doesn't support SVG. This is used for user interaction like interactive clipping. Functions using SVG shouldn't crash but they won't work as expected."),0==t.errors.length&&(t.noErrors=!0),0==t.warnings.length&&(t.noWarnings=!0),t},l.prototype.addPlugin=function(t){this._plugins.push(t),t.init&&t.init(this)},l.prototype.removePlugin=function(t){var e=this._plugins.indexOf(t,0);e<0||this._plugins.splice(e,1)},l.prototype.defineStyle=function(t,e){if(void 0===t||t<0&&t>224)throw"Style index has to be defined as a number 0-224";if(void 0===e||"undefined"==e.length||4!=e.length)throw"Colour must be defined as an array of 4 bytes";this._stylingChanged=!0;var r=new Uint8Array(e);this._stateStyles.set(r,4*t),this._handles.forEach((function(t){t.stateStyle=this._stateStyles,t.refreshStyles()}),this)},l.prototype.setState=function(t,e){if(void 0===t||!(t>=225&&t<=255))throw"State has to be defined as 225 - 255. Use xState enum.";this._handles.forEach((function(r){r.setState(t,e)}),this),this._stylingChanged=!0},l.prototype.getState=function(t){var e=null;return this._handles.forEach((function(r){e=r.getState(t)}),this),e},l.prototype.resetStates=function(t){this._handles.forEach((function(t){t.resetStates()}),this),(t=void 0===t||t)&&this._handles.forEach((function(t){t.setState(s.HIDDEN,o.IFCSPACE)}),this),this._stylingChanged=!0},l.prototype.getModelState=function(t){var e=this._handles[t];if(void 0===e)throw"Model doesn't exist";return e.getModelState()},l.prototype.restoreModelState=function(t,e){var r=this._handles[t];if(void 0===r)throw"Model doesn't exist";r.restoreModelState(e),this._stylingChanged=!0},l.prototype.setStyle=function(t,e){if(void 0===t||!(t>=0&&t<=225))throw"Style has to be defined as 0 - 225 where 225 is for default style.";var r=[this._stateStyles[4*t],this._stateStyles[4*t+1],this._stateStyles[4*t+2],this._stateStyles[4*t+3]];0==r[0]&&0==r[1]&&0==r[2]&&0==r[3]&&console&&console.warn&&console.warn("You have used undefined colour for restyling. Elements with this style will have transparent black colour and hence will be invisible."),this._handles.forEach((function(r){r.setState(t,e)}),this),this._stylingChanged=!0},l.prototype.getStyle=function(t){return this._handles.forEach((function(e){var r=e.getStyle(t);if(null!==r)return r}),this),null},l.prototype.resetStyles=function(){this._handles.forEach((function(t){t.resetStyles()}),this),this._stylingChanged=!0},l.prototype.getProductType=function(t){var e=null;return this._handles.forEach((function(r){var i=r.getProductMap(t);i&&(e=i.type)}),this),e},l.prototype.setCameraPosition=function(t){if(void 0===t)throw"Parameter coordinates must be defined";mat4.lookAt(this._mvMatrix,t,this._origin,[0,0,1])},l.prototype.setCameraTarget=function(t){var e=this,r=function(t){var r=Math.max(t[3],t[4],t[5]),i=Math.max(e._width,e._height)/Math.min(e._width,e._height);e._distance=r/Math.tan(e.perspectiveCamera.fov*Math.PI/180)*i*1};if(void 0!==t&&null!=t){var i=null;return this._handles.every((function(e){var r=e.getProductMap(t);return!r||(i=r.bBox,!1)})),!!i&&(this._origin=[i[0]+i[3]/2,i[1]+i[4]/2,i[2]+i[5]/2],r(i),!0)}var n=this._handles[0];if(n){var a=n.region;a&&(this._origin=[a.centre[0],a.centre[1],a.centre[2]],r(a.bbox))}return!0},l.prototype.set=function(t){for(key in t)this[key]=t[key]},l.prototype.load=function(t,e){if(void 0===t)throw"You have to specify model to load.";if(!("string"==typeof t||t instanceof Blob||t instanceof File))throw"Model has to be specified either as a URL to wexBIM file or Blob object representing the wexBIM file.";var r=this,i=new n;i.onloaded=function(){r._addHandle(i,e)},i.onerror=function(t){r._error(t)},i.load(t)},l.prototype._addHandle=function(t,e){var r=this._gl,i=new a(this._gl,t,null!=this._fpt);this._handles.push(i),i.stateStyle=this._stateStyles,i.feedGPU();var n=i._model.meter;if(r.uniform1f(this._meterUniformPointer,n),1===this._handles.length){this.setCameraTarget();var o=i.region,s=Math.max(o.bbox[3],o.bbox[4],o.bbox[5]);this.perspectiveCamera.far=50*s,this.perspectiveCamera.near=n/10,this.orthogonalCamera.far=this.perspectiveCamera.far,this.orthogonalCamera.near=this.perspectiveCamera.near;this.orthogonalCamera.top=s/1.8,this.orthogonalCamera.bottom=s/1.8*-1,this.orthogonalCamera.left=s/1.8*-1*this._width/this._height,this.orthogonalCamera.right=s/1.8*this._width/this._height,this.setCameraTarget();var u=Math.sqrt(this._distance*this._distance/3);this.setCameraPosition([o.centre[0]+-1*u,o.centre[1]+-1*u,o.centre[2]+u])}this._fire("loaded",{id:i.id,tag:e}),this._geometryLoaded=!0},l.prototype.unload=function(t){var e=this._handles.filter((function(e){return e.id===t})).pop();if(void 0===e)throw"Model with id: "+t+" doesn't exist or was unloaded already.";e.stopped=!0;var r=this._handles.indexOf(e);this._handles.splice(r,1),this._numberOfActiveModels=this._handles.length,e.unload(),e=void 0},l.prototype._initShaders=function(){var t=this._gl,e=this,r=function(r,i){if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))return e._error(t.getShaderInfoLog(r)),null},i=t.createShader(t.FRAGMENT_SHADER);r(i,xShaders.fragment_shader);var n=t.createShader(t.VERTEX_SHADER);null!=this._fpt?r(n,xShaders.vertex_shader):r(n,xShaders.vertex_shader_noFPT),this._shaderProgram=t.createProgram(),t.attachShader(this._shaderProgram,n),t.attachShader(this._shaderProgram,i),t.linkProgram(this._shaderProgram),t.getProgramParameter(this._shaderProgram,t.LINK_STATUS)||this._error("Could not initialise shaders "),t.useProgram(this._shaderProgram)},l.prototype._initAttributesAndUniforms=function(){var t=this._gl;this._pMatrixUniformPointer=t.getUniformLocation(this._shaderProgram,"uPMatrix"),this._mvMatrixUniformPointer=t.getUniformLocation(this._shaderProgram,"uMVMatrix"),this._lightAUniformPointer=t.getUniformLocation(this._shaderProgram,"ulightA"),this._lightBUniformPointer=t.getUniformLocation(this._shaderProgram,"ulightB"),this._colorCodingUniformPointer=t.getUniformLocation(this._shaderProgram,"uColorCoding"),this._clippingPlaneUniformPointer=t.getUniformLocation(this._shaderProgram,"uClippingPlane"),this._meterUniformPointer=t.getUniformLocation(this._shaderProgram,"uMeter"),this._renderingModeUniformPointer=t.getUniformLocation(this._shaderProgram,"uRenderingMode"),this._highlightingColourUniformPointer=t.getUniformLocation(this._shaderProgram,"uHighlightColour"),this._pointers={normalAttrPointer:t.getAttribLocation(this._shaderProgram,"aNormal"),indexlAttrPointer:t.getAttribLocation(this._shaderProgram,"aVertexIndex"),productAttrPointer:t.getAttribLocation(this._shaderProgram,"aProduct"),stateAttrPointer:t.getAttribLocation(this._shaderProgram,"aState"),styleAttrPointer:t.getAttribLocation(this._shaderProgram,"aStyleIndex"),transformationAttrPointer:t.getAttribLocation(this._shaderProgram,"aTransformationIndex"),vertexSamplerUniform:t.getUniformLocation(this._shaderProgram,"uVertexSampler"),matrixSamplerUniform:t.getUniformLocation(this._shaderProgram,"uMatrixSampler"),styleSamplerUniform:t.getUniformLocation(this._shaderProgram,"uStyleSampler"),stateStyleSamplerUniform:t.getUniformLocation(this._shaderProgram,"uStateStyleSampler"),vertexTextureSizeUniform:t.getUniformLocation(this._shaderProgram,"uVertexTextureSize"),matrixTextureSizeUniform:t.getUniformLocation(this._shaderProgram,"uMatrixTextureSize"),styleTextureSizeUniform:t.getUniformLocation(this._shaderProgram,"uStyleTextureSize")},t.enableVertexAttribArray(this._pointers.normalAttrPointer),t.enableVertexAttribArray(this._pointers.indexlAttrPointer),t.enableVertexAttribArray(this._pointers.productAttrPointer),t.enableVertexAttribArray(this._pointers.stateAttrPointer),t.enableVertexAttribArray(this._pointers.styleAttrPointer),t.enableVertexAttribArray(this._pointers.transformationAttrPointer)},l.prototype._initMouseEvents=function(){var t=this,e=!1,r=null,i=null,n=null,a=null,o="L",s=-1;function u(e,r,i){if(t._handles&&t._handles[0]){var n=t._origin,a=t.getCameraPosition(),o=vec3.transformMat4(vec3.create(),n,t._mvMatrix),s=vec3.subtract(vec3.create(),n,a),u=Math.max(vec3.length(s),t._handles[0]._model.meter),l=mat4.translate(mat4.create(),mat4.create(),o);switch(e){case"free-orbit":l=mat4.rotate(mat4.create(),l,f(i/4),[1,0,0]),l=mat4.rotate(mat4.create(),l,f(r/4),[0,1,0]);break;case"fixed-orbit":case"orbit":mat4.rotate(l,l,f(i/4),[1,0,0]);var h=vec3.transformMat3(vec3.create(),[0,0,1],mat3.fromMat4(mat3.create(),t._mvMatrix));h=vec3.normalize(vec3.create(),h),l=mat4.rotate(mat4.create(),l,f(r/4),h);break;case"pan":mat4.translate(l,l,[r*u/150,0,0]),mat4.translate(l,l,[0,-1*i*u/150,0]);break;case"zoom":mat4.translate(l,l,[0,0,r*u/20]),mat4.translate(l,l,[0,0,i*u/20])}var c=vec3.negate(vec3.create(),o);l=mat4.translate(mat4.create(),l,c),t._mvMatrix=mat4.multiply(mat4.create(),l,t._mvMatrix)}function f(t){return t*Math.PI/180}}var l=t.height,h=t.width;setInterval((function(){t._canvas.offsetHeight===l&&t._canvas.offsetWidth===h||(l=t._height=t._canvas.height=t._canvas.offsetHeight,h=t._width=t._canvas.width=t._canvas.offsetWidth)}),500),this._canvas.addEventListener("mousedown",(function(u){e=!0,r=u.clientX,i=u.clientY,n=u.clientX,a=u.clientY;var l=t._canvas.getBoundingClientRect(),h=n-l.left,c=t._height-(a-l.top);switch(s=t._getID(h,c),t._fire("mouseDown",{id:s}),u.button){case 0:o="left";break;case 1:o="middle";break;case 2:o="right";break;default:o="left"}t._disableTextSelection()}),!0),this._canvas.addEventListener("wheel",(function(e){function r(t){return 0===(t=+t)||isNaN(t)?t:t>0?1:-1}"none"!=t.navigationMode&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),u("zoom",-1*r(e.deltaX),-1*r(e.deltaY)))}),!0),window.addEventListener("mouseup",(function(r){e=!1;var i=r.clientX,u=r.clientY,l=Math.abs(i-n),h=Math.abs(u-a);if(l<3&&h<3&&"left"==o){var c=!1;t._plugins.forEach((function(t){t.onBeforePick&&(c=c||t.onBeforePick(s))}),this),c||t._fire("pick",{id:s})}t._enableTextSelection()}),!0),window.addEventListener("mousemove",(function(n){if(e&&"none"!=t.navigationMode){var a=n.clientX,s=n.clientY,l=a-r,h=s-i;if(r=a,i=s,"left"==o)switch(t.navigationMode){case"free-orbit":u("free-orbit",l,h);break;case"fixed-orbit":case"orbit":u("orbit",l,h);break;case"pan":u("pan",l,h);break;case"zoom":u("zoom",l,h)}"middle"==o&&u("pan",l,h)}}),!0),this._canvas.addEventListener("mousemove",(function(){t._userAction=!0}),!0),this._canvas.addEventListener("dblclick",(function(){t._fire("dblclick",{id:s})}),!0)},l.prototype.draw=function(){if(this._geometryLoaded&&0!=this._handles.length&&(this._stylingChanged||this._isChanged())||this._userAction){this._userAction=!1,this._plugins.forEach((function(t){t.onBeforeDraw&&t.onBeforeDraw()}),this),this._stylingChanged=!1;var t=this._gl,e=this._width,r=this._height;switch(t.useProgram(this._shaderProgram),t.viewport(0,0,e,r),t.clearColor(this.background[0]/255,this.background[1]/255,this.background[2]/255,this.background[3]/255),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.camera){case"perspective":mat4.perspective(this._pMatrix,this.perspectiveCamera.fov*Math.PI/180,this._width/this._height,this.perspectiveCamera.near,this.perspectiveCamera.far);break;case"orthogonal":mat4.ortho(this._pMatrix,this.orthogonalCamera.left,this.orthogonalCamera.right,this.orthogonalCamera.bottom,this.orthogonalCamera.top,this.orthogonalCamera.near,this.orthogonalCamera.far);break;default:mat4.perspective(this._pMatrix,this.perspectiveCamera.fov*Math.PI/180,this._width/this._height,this.perspectiveCamera.near,this.perspectiveCamera.far)}t.uniformMatrix4fv(this._pMatrixUniformPointer,!1,this._pMatrix),t.uniformMatrix4fv(this._mvMatrixUniformPointer,!1,this._mvMatrix),t.uniform4fv(this._lightAUniformPointer,new Float32Array(this.lightA)),t.uniform4fv(this._lightBUniformPointer,new Float32Array(this.lightB)),t.uniform4fv(this._clippingPlaneUniformPointer,new Float32Array(this.clippingPlane)),t.uniform1i(this._colorCodingUniformPointer,0),t.uniform4fv(this._highlightingColourUniformPointer,new Float32Array([this.highlightingColour[0]/255,this.highlightingColour[1]/255,this.highlightingColour[2]/255,this.highlightingColour[3]/255])),"x-ray"==this.renderingMode?(t.uniform1i(this._renderingModeUniformPointer,2),t.disable(t.CULL_FACE),this._handles.forEach((function(t){t.stopped||(t.setActive(this._pointers),t.draw("solid"))}),this),t.uniform1i(this._renderingModeUniformPointer,2),t.enable(t.CULL_FACE),this._handles.forEach((function(t){t.stopped||(t.setActive(this._pointers),t.draw("transparent"))}),this),t.uniform1i(this._renderingModeUniformPointer,0)):(t.uniform1i(this._renderingModeUniformPointer,0),t.disable(t.CULL_FACE),this._handles.forEach((function(t){t.stopped||(t.setActive(this._pointers),t.draw("solid"))}),this),this._handles.forEach((function(t){t.stopped||(t.setActive(this._pointers),t.draw("transparent"))}),this)),this._plugins.forEach((function(t){t.onAfterDraw&&t.onAfterDraw()}),this),this._fire("frame",{})}},l.prototype._isChanged=function(){var t=!0;return this._visualStateAttributes.forEach((function(e){var r=JSON.stringify(this[e]),i=this._lastStates[e];this._lastStates[e]=r,t=t&&r===i}),this),!t},l.prototype.getCameraPosition=function(){var t=mat4.create();mat4.multiply(t,this._pMatrix,this._mvMatrix);var e=mat4.create();mat4.invert(e,t);var r=vec3.create();return vec3.transformMat4(r,vec3.create(),e),r},l.prototype.zoomTo=function(t){if(!this.setCameraTarget(t))return!1;var e=this.getCameraPosition(),r=vec3.create();vec3.subtract(r,e,this._origin),r=vec3.normalize(vec3.create(),r);var i=vec3.create();return vec3.scale(i,r,this._distance),vec3.add(e,i,this._origin),mat4.lookAt(this._mvMatrix,e,this._origin,[0,0,1]),!0},l.prototype.show=function(t){var e=this._origin,r=this._distance,i=[0,0,0];switch(t){case"top":return void mat4.translate(this._mvMatrix,mat4.create(),[-1*e[0],-1*e[1],-1*(r+e[2])]);case"bottom":var n=mat4.translate(mat4.create(),mat4.create(),[-1*e[0],1*e[1],-1*(e[2]+r)]),a=mat4.rotateY(mat4.create(),n,Math.PI),o=mat4.rotateZ(mat4.create(),a,Math.PI);return void(this._mvMatrix=o);case"front":i=[e[0],e[1]-r,e[2]];break;case"back":i=[e[0],e[1]+r,e[2]];break;case"left":i=[e[0]-r,e[1],e[2]];break;case"right":i=[e[0]+r,e[1],e[2]]}mat4.lookAt(this._mvMatrix,i,e,[0,0,1])},l.prototype._error=function(t){this._fire("error",{message:t})},l.prototype._getID=function(t,e){this._plugins.forEach((function(t){t.onBeforeDrawId&&t.onBeforeDrawId()}),this);var r=this._gl,i=this._width/2,n=this._height/2;t/=2,e/=2;var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a);var o=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,o),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,i,n);var s=r.createTexture();if(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i,n,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,o),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0),r.checkFramebufferStatus(r.FRAMEBUFFER)!=r.FRAMEBUFFER_COMPLETE)return this._error("this combination of attachments does not work"),null;r.bindFramebuffer(r.FRAMEBUFFER,a),r.viewport(0,0,i,n),r.enable(r.DEPTH_TEST),r.disable(r.BLEND),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.uniform1i(this._colorCodingUniformPointer,1),this._handles.forEach((function(t){t.stopped||(t.setActive(this._pointers),t.draw())}),this),this._plugins.forEach((function(t){t.onAfterDrawId&&t.onAfterDrawId()}),this);var u=new Uint8Array(4);if(r.readPixels(t,e,1,1,r.RGBA,r.UNSIGNED_BYTE,u),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteRenderbuffer(o),r.deleteFramebuffer(a),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND),0!=u[3]){var l=u[0]+256*u[1]+256*u[2]*256,h=!1;return this._plugins.forEach((function(t){t.onBeforeGetId&&(h=h||t.onBeforeGetId(l))}),this),h?null:l}return null},l.prototype.start=function(t){if(void 0!==t){var e=this._handles.filter((function(e){return e.id===t})).pop();if(void 0===e)throw"Model doesn't exist.";return e.stopped=!1,void this._numberOfActiveModels++}this._isRunning=!0;var r=this,i=new Date,n=0;!function t(){if(30==++n){n=0;var e=new Date,a=e.getTime()-i.getTime();i=e;var o=1e3/a*30;r._fire("fps",Math.floor(o))}r._isRunning&&(window.requestAnimFrame(t),r.draw())}()},l.prototype.stop=function(t){if(void 0!==t){var e=this._handles.filter((function(e){return e.id===t})).pop();if(void 0===e)throw"Model doesn't exist.";e.stopped=!0,this._numberOfActiveModels--}else this._isRunning=!1},l.prototype.on=function(t,e){var r=this._events;r[t]||(r[t]=[]),r[t].push(e)},l.prototype.off=function(t,e){var r=this._events[t];if(r){var i=r.indexOf(e);i>=0&&r.splice(i,1)}},l.prototype._fire=function(t,e){var r=this._events[t];r&&r.forEach((function(t){t(e)}),this)},l.prototype._disableTextSelection=function(){document.documentElement.style["-webkit-touch-callout"]="none",document.documentElement.style["-webkit-user-select"]="none",document.documentElement.style["-khtml-user-select"]="none",document.documentElement.style["-moz-user-select"]="none",document.documentElement.style["-ms-user-select"]="none",document.documentElement.style["user-select"]="none"},l.prototype._enableTextSelection=function(){document.documentElement.style["-webkit-touch-callout"]="text",document.documentElement.style["-webkit-user-select"]="text",document.documentElement.style["-khtml-user-select"]="text",document.documentElement.style["-moz-user-select"]="text",document.documentElement.style["-ms-user-select"]="text",document.documentElement.style["user-select"]="text"},l.prototype._getSVGOverlay=function(){if(!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))return!1;var t,e,r,i,n,a,o,s,u,l,h,c,f,d=document.createElementNS("http://www.w3.org/2000/svg","svg"),m=(t=this._canvas,e=t.getBoundingClientRect(),r=document.body,i=document.documentElement,n=window.pageYOffset||i.scrollTop||r.scrollTop,a=window.pageXOffset||i.scrollLeft||r.scrollLeft,o=i.clientTop||r.clientTop||0,s=i.clientLeft||r.clientLeft||0,u=i.clientBottom||r.clientBottom||0,l=i.clientRight||r.clientRight||0,h=Math.round(e.top+n-o),c=Math.round(e.left+a-s),f=Math.round(e.top+n-u),{top:h,left:c,width:Math.round(e.left+a-l)-c,height:f-h});return d.style.position="absolute",d.style.top=m.top+"px",d.style.left=m.left+"px",d.style["z-index"]=100,d.setAttribute("width",this._width),d.setAttribute("height",this._height),d},l.prototype.getClip=function(){var t=this.clippingPlane;if(t.every((function(t){return 0===t})))return[[0,0,0],[0,0,0]];var e=vec3.normalize([0,0,0],[t[0],t[1],t[2]]),r=this._lastClippingPoint,i=r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+t[3];return Math.abs(i)<1e-5?[r,e]:[[0!==t[0]?-1*t[3]/t[0]:0,0!==t[1]?-1*t[3]/t[1]:0,0!==t[2]?-1*t[3]/t[2]:0],e]},l.prototype.clip=function(t,e){if(void 0!==t&&void 0!==e){this._lastClippingPoint=t;var r=0-e[0]*t[0]-e[1]*t[1]-e[2]*t[2];return this.clippingPlane=[e[0],e[1],e[2],r],void this._fire("clipped",{})}var i="http://www.w3.org/2000/svg",n=this._getSVGOverlay(),a=this,o={},s=!1,u={},l=function(t){if(!s){s=!0,a._disableTextSelection();var e=n.getBoundingClientRect();o.x=t.clientX-e.left,o.y=t.clientY-e.top,o.angle=0,(u=document.createElementNS(i,"g")).setAttribute("id","section"),n.appendChild(u);var r=document.createElementNS(i,"line");u.appendChild(r),r.setAttribute("style","stroke:rgb(255,0,0);stroke-width:2"),r.setAttribute("x1",o.x),r.setAttribute("y1",99999),r.setAttribute("x2",o.x),r.setAttribute("y2",-99999)}},h=function(t){if(s){var e=n.getBoundingClientRect();if(o.x!=t.clientX-e.left||o.y!=t.clientY-e.top){s=!1,a._enableTextSelection();var r=mat4.create();mat4.multiply(r,a._pMatrix,a._mvMatrix);var i=mat4.create();mat4.invert(i,r);var u=o.x/(a._width/2)-1,f=1-o.y/(a._height/2),d=vec3.create();vec3.transformMat4(d,[u,f,-1],i);var m=vec3.create();vec3.transformMat4(m,[u,f,1],i);var v=o.angle*Math.PI/180,p=u+Math.cos(v),g=f+Math.sin(v),E=vec3.create();vec3.transformMat4(E,[p,g,1],i);var I=vec3.subtract(vec3.create(),d,m),x=vec3.subtract(vec3.create(),E,m),C=vec3.cross(vec3.create(),I,x);a.clip(m,C),n.parentNode.removeChild(n),n.removeEventListener("mousedown",l,!0),window.removeEventListener("mouseup",h,!0),window.removeEventListener("mousemove",c,!0)}}},c=function(t){if(s){var e=n.getBoundingClientRect(),r=t.clientX-e.left,i=t.clientY-e.top,a=r-o.x,l=i-o.y,h=-180*Math.atan2(a,l)/Math.PI+90;h=5*Math.round(h/5),o.angle=360-h+90,u.setAttribute("transform","rotate("+h+" "+o.x+" "+o.y+")")}};document.documentElement.appendChild(n),n.addEventListener("mousedown",l,!0),window.addEventListener("mouseup",h,!0),window.addEventListener("mousemove",c,!0),this.stopClipping=function(){n.parentNode.removeChild(n),n.removeEventListener("mousedown",l,!0),window.removeEventListener("mouseup",h,!0),window.removeEventListener("mousemove",c,!0),a.stopClipping=function(){}}},l.prototype.stopClipping=function(){},l.prototype.unclip=function(){this.clippingPlane=[0,0,0,0],this._fire("unclipped",{})};var h,c,f,d={create3DContext:h=function(t,e){for(var r=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,n=0;n<r.length;++n){try{i=t.getContext(r[n],e)}catch(t){}if(i)break}return i},setupWebGL:function(t,e,r){r=r||function(e){var r=t.parentNode;if(r){var i=window.WebGLRenderingContext?'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>':'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>';e&&(i+="<br/><br/>Status: "+e),r.innerHTML=function(t){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>"}(i)}},t.addEventListener&&t.addEventListener("webglcontextcreationerror",(function(t){r(t.statusMessage)}),!1);var i=h(t,e);return i||window.WebGLRenderingContext||r(""),i}};window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)},c=window,(f={}).exports=e,function(t){if(!e)var e=1e-6;if(!r)var r="undefined"!=typeof Float32Array?Float32Array:Array;if(!i)var i=Math.random;var n={setMatrixArrayType:function(t){r=t}};void 0!==t&&(t.glMatrix=n);var a=Math.PI/180;n.toRadian=function(t){return t*a};var o,s={create:function(){var t=new r(2);return t[0]=0,t[1]=0,t},clone:function(t){var e=new r(2);return e[0]=t[0],e[1]=t[1],e},fromValues:function(t,e){var i=new r(2);return i[0]=t,i[1]=e,i},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,r){return t[0]=e,t[1]=r,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},subtract:function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}};s.sub=s.subtract,s.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t},s.mul=s.multiply,s.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t},s.div=s.divide,s.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},s.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},s.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},s.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t},s.distance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)},s.dist=s.distance,s.squaredDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)},s.len=s.length,s.squaredLength=function(t){var e=t[0],r=t[1];return e*e+r*r},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},s.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},s.normalize=function(t,e){var r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},s.cross=function(t,e,r){var i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t},s.lerp=function(t,e,r,i){var n=e[0],a=e[1];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t},s.random=function(t,e){e=e||1;var r=2*i()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},s.transformMat2=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t},s.transformMat2d=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t},s.transformMat3=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t},s.transformMat4=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t},s.forEach=(o=s.create(),function(t,e,r,i,n,a){var s,u;for(e||(e=2),r||(r=0),u=i?Math.min(i*e+r,t.length):t.length,s=r;s<u;s+=e)o[0]=t[s],o[1]=t[s+1],n(o,o,a),t[s]=o[0],t[s+1]=o[1];return t}),s.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},void 0!==t&&(t.vec2=s),c.vec3={},vec3.create=function(){var t=new r(3);return t[0]=0,t[1]=0,t[2]=0,t},vec3.clone=function(t){var e=new r(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.fromValues=function(t,e,i){var n=new r(3);return n[0]=t,n[1]=e,n[2]=i,n},vec3.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},vec3.set=function(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t},vec3.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},vec3.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},vec3.sub=vec3.subtract,vec3.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},vec3.mul=vec3.multiply,vec3.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},vec3.div=vec3.divide,vec3.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},vec3.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},vec3.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},vec3.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t},vec3.distance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)},vec3.dist=vec3.distance,vec3.squaredDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n},vec3.sqrDist=vec3.squaredDistance,vec3.length=function(t){var e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)},vec3.len=vec3.length,vec3.squaredLength=function(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i},vec3.sqrLen=vec3.squaredLength,vec3.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},vec3.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},vec3.normalize=function(t,e){var r=e[0],i=e[1],n=e[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},vec3.cross=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return t[0]=n*u-a*s,t[1]=a*o-i*u,t[2]=i*s-n*o,t},vec3.lerp=function(t,e,r,i){var n=e[0],a=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t[2]=o+i*(r[2]-o),t},vec3.random=function(t,e){e=e||1;var r=2*i()*Math.PI,n=2*i()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=n*e,t},vec3.transformMat4=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=r[3]*i+r[7]*n+r[11]*a+r[15];return o=o||1,t[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/o,t[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/o,t[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/o,t},vec3.transformMat3=function(t,e,r){var i=e[0],n=e[1],a=e[2];return t[0]=i*r[0]+n*r[3]+a*r[6],t[1]=i*r[1]+n*r[4]+a*r[7],t[2]=i*r[2]+n*r[5]+a*r[8],t},vec3.transformQuat=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=r[0],s=r[1],u=r[2],l=r[3],h=l*i+s*a-u*n,c=l*n+u*i-o*a,f=l*a+o*n-s*i,d=-o*i-s*n-u*a;return t[0]=h*l+d*-o+c*-u-f*-s,t[1]=c*l+d*-s+f*-o-h*-u,t[2]=f*l+d*-u+h*-s-c*-o,t},vec3.rotateX=function(t,e,r,i){var n=[],a=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},vec3.rotateY=function(t,e,r,i){var n=[],a=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},vec3.rotateZ=function(t,e,r,i){var n=[],a=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},vec3.forEach=function(){var t=vec3.create();return function(e,r,i,n,a,o){var s,u;for(r||(r=3),i||(i=0),u=n?Math.min(n*r+i,e.length):e.length,s=i;s<u;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),vec3.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},void 0!==t&&(t.vec3=vec3);var u={create:function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},clone:function(t){var e=new r(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:function(t,e,i,n){var a=new r(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},set:function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},subtract:function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}};u.sub=u.subtract,u.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},u.mul=u.multiply,u.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},u.div=u.divide,u.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},u.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},u.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},u.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},u.distance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+a*a)},u.dist=u.distance,u.squaredDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return r*r+i*i+n*n+a*a},u.sqrDist=u.squaredDistance,u.length=function(t){var e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)},u.len=u.length,u.squaredLength=function(t){var e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n},u.sqrLen=u.squaredLength,u.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},u.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},u.normalize=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=r*r+i*i+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o),t},u.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},u.lerp=function(t,e,r,i){var n=e[0],a=e[1],o=e[2],s=e[3];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t[2]=o+i*(r[2]-o),t[3]=s+i*(r[3]-s),t},u.random=function(t,e){return e=e||1,t[0]=i(),t[1]=i(),t[2]=i(),t[3]=i(),u.normalize(t,t),u.scale(t,t,e),t},u.transformMat4=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,t},u.transformQuat=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=r[0],s=r[1],u=r[2],l=r[3],h=l*i+s*a-u*n,c=l*n+u*i-o*a,f=l*a+o*n-s*i,d=-o*i-s*n-u*a;return t[0]=h*l+d*-o+c*-u-f*-s,t[1]=c*l+d*-s+f*-o-h*-u,t[2]=f*l+d*-u+h*-s-c*-o,t},u.forEach=function(){var t=u.create();return function(e,r,i,n,a,o){var s,u;for(r||(r=4),i||(i=0),u=n?Math.min(n*r+i,e.length):e.length,s=i;s<u;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),u.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==t&&(t.vec4=u);var l={create:function(){var t=new r(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},clone:function(t){var e=new r(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},transpose:function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=r*a-n*i;return o?(o=1/o,t[0]=a*o,t[1]=-i*o,t[2]=-n*o,t[3]=r*o,t):null},adjoint:function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],h=r[3];return t[0]=i*s+a*u,t[1]=n*s+o*u,t[2]=i*l+a*h,t[3]=n*l+o*h,t}};l.mul=l.multiply,l.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=i*u+a*s,t[1]=n*u+o*s,t[2]=i*-s+a*u,t[3]=n*-s+o*u,t},l.scale=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=r[0],u=r[1];return t[0]=i*s,t[1]=n*s,t[2]=a*u,t[3]=o*u,t},l.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},l.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},l.LDU=function(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]},void 0!==t&&(t.mat2=l);var h={create:function(){var t=new r(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},clone:function(t){var e=new r(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=r*a-i*n;return u?(u=1/u,t[0]=a*u,t[1]=-i*u,t[2]=-n*u,t[3]=r*u,t[4]=(n*s-a*o)*u,t[5]=(i*o-r*s)*u,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=r[0],h=r[1],c=r[2],f=r[3],d=r[4],m=r[5];return t[0]=i*l+a*h,t[1]=n*l+o*h,t[2]=i*c+a*f,t[3]=n*c+o*f,t[4]=i*d+a*m+s,t[5]=n*d+o*m+u,t}};h.mul=h.multiply,h.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=Math.sin(r),h=Math.cos(r);return t[0]=i*h+a*l,t[1]=n*h+o*l,t[2]=i*-l+a*h,t[3]=n*-l+o*h,t[4]=s,t[5]=u,t},h.scale=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=r[0],h=r[1];return t[0]=i*l,t[1]=n*l,t[2]=a*h,t[3]=o*h,t[4]=s,t[5]=u,t},h.translate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=r[0],h=r[1];return t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=i*l+a*h+s,t[5]=n*l+o*h+u,t},h.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},h.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},void 0!==t&&(t.mat2d=h),c.mat3={},mat3.create=function(){var t=new r(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},mat3.clone=function(t){var e=new r(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},mat3.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=h*o-s*l,f=-h*a+s*u,d=l*a-o*u,m=r*c+i*f+n*d;return m?(m=1/m,t[0]=c*m,t[1]=(-h*i+n*l)*m,t[2]=(s*i-n*o)*m,t[3]=f*m,t[4]=(h*r-n*u)*m,t[5]=(-s*r+n*a)*m,t[6]=d*m,t[7]=(-l*r+i*u)*m,t[8]=(o*r-i*a)*m,t):null},mat3.adjoint=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8];return t[0]=o*h-s*l,t[1]=n*l-i*h,t[2]=i*s-n*o,t[3]=s*u-a*h,t[4]=r*h-n*u,t[5]=n*a-r*s,t[6]=a*l-o*u,t[7]=i*u-r*l,t[8]=r*o-i*a,t},mat3.determinant=function(t){var e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return e*(l*a-o*u)+r*(-l*n+o*s)+i*(u*n-a*s)},mat3.multiply=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=r[0],d=r[1],m=r[2],v=r[3],p=r[4],g=r[5],E=r[6],I=r[7],x=r[8];return t[0]=f*i+d*o+m*l,t[1]=f*n+d*s+m*h,t[2]=f*a+d*u+m*c,t[3]=v*i+p*o+g*l,t[4]=v*n+p*s+g*h,t[5]=v*a+p*u+g*c,t[6]=E*i+I*o+x*l,t[7]=E*n+I*s+x*h,t[8]=E*a+I*u+x*c,t},mat3.mul=mat3.multiply,mat3.translate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=r[0],d=r[1];return t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=f*i+d*o+l,t[7]=f*n+d*s+h,t[8]=f*a+d*u+c,t},mat3.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=Math.sin(r),d=Math.cos(r);return t[0]=d*i+f*o,t[1]=d*n+f*s,t[2]=d*a+f*u,t[3]=d*o-f*i,t[4]=d*s-f*n,t[5]=d*u-f*a,t[6]=l,t[7]=h,t[8]=c,t},mat3.scale=function(t,e,r){var i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},mat3.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},mat3.fromQuat=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=r+r,s=i+i,u=n+n,l=r*o,h=i*o,c=i*s,f=n*o,d=n*s,m=n*u,v=a*o,p=a*s,g=a*u;return t[0]=1-c-m,t[3]=h-g,t[6]=f+p,t[1]=h+g,t[4]=1-l-m,t[7]=d-v,t[2]=f-p,t[5]=d+v,t[8]=1-l-c,t},mat3.normalFromMat4=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],d=e[11],m=e[12],v=e[13],p=e[14],g=e[15],E=r*s-i*o,I=r*u-n*o,x=r*l-a*o,C=i*u-n*s,T=i*l-a*s,_=n*l-a*u,A=h*v-c*m,M=h*p-f*m,y=h*g-d*m,F=c*p-f*v,S=c*g-d*v,R=f*g-d*p,b=E*R-I*S+x*F+C*y-T*M+_*A;return b?(b=1/b,t[0]=(s*R-u*S+l*F)*b,t[1]=(u*y-o*R-l*M)*b,t[2]=(o*S-s*y+l*A)*b,t[3]=(n*S-i*R-a*F)*b,t[4]=(r*R-n*y+a*M)*b,t[5]=(i*y-r*S-a*A)*b,t[6]=(v*_-p*T+g*C)*b,t[7]=(p*x-m*_-g*I)*b,t[8]=(m*T-v*x+g*E)*b,t):null},mat3.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},mat3.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},void 0!==t&&(t.mat3=mat3),c.mat4={},mat4.create=function(){var t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.clone=function(t){var e=new r(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},mat4.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],d=e[11],m=e[12],v=e[13],p=e[14],g=e[15],E=r*s-i*o,I=r*u-n*o,x=r*l-a*o,C=i*u-n*s,T=i*l-a*s,_=n*l-a*u,A=h*v-c*m,M=h*p-f*m,y=h*g-d*m,F=c*p-f*v,S=c*g-d*v,R=f*g-d*p,b=E*R-I*S+x*F+C*y-T*M+_*A;return b?(b=1/b,t[0]=(s*R-u*S+l*F)*b,t[1]=(n*S-i*R-a*F)*b,t[2]=(v*_-p*T+g*C)*b,t[3]=(f*T-c*_-d*C)*b,t[4]=(u*y-o*R-l*M)*b,t[5]=(r*R-n*y+a*M)*b,t[6]=(p*x-m*_-g*I)*b,t[7]=(h*_-f*x+d*I)*b,t[8]=(o*S-s*y+l*A)*b,t[9]=(i*y-r*S-a*A)*b,t[10]=(m*T-v*x+g*E)*b,t[11]=(c*x-h*T-d*E)*b,t[12]=(s*M-o*F-u*A)*b,t[13]=(r*F-i*M+n*A)*b,t[14]=(v*I-m*C-p*E)*b,t[15]=(h*C-c*I+f*E)*b,t):null},mat4.adjoint=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],d=e[11],m=e[12],v=e[13],p=e[14],g=e[15];return t[0]=s*(f*g-d*p)-c*(u*g-l*p)+v*(u*d-l*f),t[1]=-(i*(f*g-d*p)-c*(n*g-a*p)+v*(n*d-a*f)),t[2]=i*(u*g-l*p)-s*(n*g-a*p)+v*(n*l-a*u),t[3]=-(i*(u*d-l*f)-s*(n*d-a*f)+c*(n*l-a*u)),t[4]=-(o*(f*g-d*p)-h*(u*g-l*p)+m*(u*d-l*f)),t[5]=r*(f*g-d*p)-h*(n*g-a*p)+m*(n*d-a*f),t[6]=-(r*(u*g-l*p)-o*(n*g-a*p)+m*(n*l-a*u)),t[7]=r*(u*d-l*f)-o*(n*d-a*f)+h*(n*l-a*u),t[8]=o*(c*g-d*v)-h*(s*g-l*v)+m*(s*d-l*c),t[9]=-(r*(c*g-d*v)-h*(i*g-a*v)+m*(i*d-a*c)),t[10]=r*(s*g-l*v)-o*(i*g-a*v)+m*(i*l-a*s),t[11]=-(r*(s*d-l*c)-o*(i*d-a*c)+h*(i*l-a*s)),t[12]=-(o*(c*p-f*v)-h*(s*p-u*v)+m*(s*f-u*c)),t[13]=r*(c*p-f*v)-h*(i*p-n*v)+m*(i*f-n*c),t[14]=-(r*(s*p-u*v)-o*(i*p-n*v)+m*(i*u-n*s)),t[15]=r*(s*f-u*c)-o*(i*f-n*c)+h*(i*u-n*s),t},mat4.determinant=function(t){var e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],h=t[9],c=t[10],f=t[11],d=t[12],m=t[13],v=t[14],p=t[15];return(e*o-r*a)*(c*p-f*v)-(e*s-i*a)*(h*p-f*m)+(e*u-n*a)*(h*v-c*m)+(r*s-i*o)*(l*p-f*d)-(r*u-n*o)*(l*v-c*d)+(i*u-n*s)*(l*m-h*d)},mat4.multiply=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=e[9],d=e[10],m=e[11],v=e[12],p=e[13],g=e[14],E=e[15],I=r[0],x=r[1],C=r[2],T=r[3];return t[0]=I*i+x*s+C*c+T*v,t[1]=I*n+x*u+C*f+T*p,t[2]=I*a+x*l+C*d+T*g,t[3]=I*o+x*h+C*m+T*E,I=r[4],x=r[5],C=r[6],T=r[7],t[4]=I*i+x*s+C*c+T*v,t[5]=I*n+x*u+C*f+T*p,t[6]=I*a+x*l+C*d+T*g,t[7]=I*o+x*h+C*m+T*E,I=r[8],x=r[9],C=r[10],T=r[11],t[8]=I*i+x*s+C*c+T*v,t[9]=I*n+x*u+C*f+T*p,t[10]=I*a+x*l+C*d+T*g,t[11]=I*o+x*h+C*m+T*E,I=r[12],x=r[13],C=r[14],T=r[15],t[12]=I*i+x*s+C*c+T*v,t[13]=I*n+x*u+C*f+T*p,t[14]=I*a+x*l+C*d+T*g,t[15]=I*o+x*h+C*m+T*E,t},mat4.mul=mat4.multiply,mat4.translate=function(t,e,r){var i,n,a,o,s,u,l,h,c,f,d,m,v=r[0],p=r[1],g=r[2];return e===t?(t[12]=e[0]*v+e[4]*p+e[8]*g+e[12],t[13]=e[1]*v+e[5]*p+e[9]*g+e[13],t[14]=e[2]*v+e[6]*p+e[10]*g+e[14],t[15]=e[3]*v+e[7]*p+e[11]*g+e[15]):(i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=e[9],d=e[10],m=e[11],t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=h,t[8]=c,t[9]=f,t[10]=d,t[11]=m,t[12]=i*v+s*p+c*g+e[12],t[13]=n*v+u*p+f*g+e[13],t[14]=a*v+l*p+d*g+e[14],t[15]=o*v+h*p+m*g+e[15]),t},mat4.scale=function(t,e,r){var i=r[0],n=r[1],a=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},mat4.rotate=function(t,r,i,n){var a,o,s,u,l,h,c,f,d,m,v,p,g,E,I,x,C,T,_,A,M,y,F,S,R=n[0],b=n[1],P=n[2],w=Math.sqrt(R*R+b*b+P*P);return Math.abs(w)<e?null:(R*=w=1/w,b*=w,P*=w,a=Math.sin(i),s=1-(o=Math.cos(i)),u=r[0],l=r[1],h=r[2],c=r[3],f=r[4],d=r[5],m=r[6],v=r[7],p=r[8],g=r[9],E=r[10],I=r[11],x=R*R*s+o,C=b*R*s+P*a,T=P*R*s-b*a,_=R*b*s-P*a,A=b*b*s+o,M=P*b*s+R*a,y=R*P*s+b*a,F=b*P*s-R*a,S=P*P*s+o,t[0]=u*x+f*C+p*T,t[1]=l*x+d*C+g*T,t[2]=h*x+m*C+E*T,t[3]=c*x+v*C+I*T,t[4]=u*_+f*A+p*M,t[5]=l*_+d*A+g*M,t[6]=h*_+m*A+E*M,t[7]=c*_+v*A+I*M,t[8]=u*y+f*F+p*S,t[9]=l*y+d*F+g*S,t[10]=h*y+m*F+E*S,t[11]=c*y+v*F+I*S,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},mat4.rotateX=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],h=e[9],c=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+l*i,t[5]=o*n+h*i,t[6]=s*n+c*i,t[7]=u*n+f*i,t[8]=l*n-a*i,t[9]=h*n-o*i,t[10]=c*n-s*i,t[11]=f*n-u*i,t},mat4.rotateY=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],h=e[9],c=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-l*i,t[1]=o*n-h*i,t[2]=s*n-c*i,t[3]=u*n-f*i,t[8]=a*i+l*n,t[9]=o*i+h*n,t[10]=s*i+c*n,t[11]=u*i+f*n,t},mat4.rotateZ=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],h=e[5],c=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+l*i,t[1]=o*n+h*i,t[2]=s*n+c*i,t[3]=u*n+f*i,t[4]=l*n-a*i,t[5]=h*n-o*i,t[6]=c*n-s*i,t[7]=f*n-u*i,t},mat4.fromRotationTranslation=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=i+i,u=n+n,l=a+a,h=i*s,c=i*u,f=i*l,d=n*u,m=n*l,v=a*l,p=o*s,g=o*u,E=o*l;return t[0]=1-(d+v),t[1]=c+E,t[2]=f-g,t[3]=0,t[4]=c-E,t[5]=1-(h+v),t[6]=m+p,t[7]=0,t[8]=f+g,t[9]=m-p,t[10]=1-(h+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},mat4.fromQuat=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=r+r,s=i+i,u=n+n,l=r*o,h=i*o,c=i*s,f=n*o,d=n*s,m=n*u,v=a*o,p=a*s,g=a*u;return t[0]=1-c-m,t[1]=h+g,t[2]=f-p,t[3]=0,t[4]=h-g,t[5]=1-l-m,t[6]=d+v,t[7]=0,t[8]=f+p,t[9]=d-v,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.frustum=function(t,e,r,i,n,a,o){var s=1/(r-e),u=1/(n-i),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(n+i)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t},mat4.perspective=function(t,e,r,i,n){var a=1/Math.tan(e/2),o=1/(i-n);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+i)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*i*o,t[15]=0,t},mat4.ortho=function(t,e,r,i,n,a,o){var s=1/(e-r),u=1/(i-n),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(n+i)*u,t[14]=(o+a)*l,t[15]=1,t},mat4.lookAt=function(t,r,i,n){var a,o,s,u,l,h,c,f,d,m,v=r[0],p=r[1],g=r[2],E=n[0],I=n[1],x=n[2],C=i[0],T=i[1],_=i[2];return Math.abs(v-C)<e&&Math.abs(p-T)<e&&Math.abs(g-_)<e?mat4.identity(t):(c=v-C,f=p-T,d=g-_,a=I*(d*=m=1/Math.sqrt(c*c+f*f+d*d))-x*(f*=m),o=x*(c*=m)-E*d,s=E*f-I*c,(m=Math.sqrt(a*a+o*o+s*s))?(a*=m=1/m,o*=m,s*=m):(a=0,o=0,s=0),u=f*s-d*o,l=d*a-c*s,h=c*o-f*a,(m=Math.sqrt(u*u+l*l+h*h))?(u*=m=1/m,l*=m,h*=m):(u=0,l=0,h=0),t[0]=a,t[1]=u,t[2]=c,t[3]=0,t[4]=o,t[5]=l,t[6]=f,t[7]=0,t[8]=s,t[9]=h,t[10]=d,t[11]=0,t[12]=-(a*v+o*p+s*g),t[13]=-(u*v+l*p+h*g),t[14]=-(c*v+f*p+d*g),t[15]=1,t)},mat4.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},mat4.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},void 0!==t&&(t.mat4=mat4);var f,d,m,v,p={create:function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}};p.rotationTo=(f=vec3.create(),d=vec3.fromValues(1,0,0),m=vec3.fromValues(0,1,0),function(t,e,r){var i=vec3.dot(e,r);return i<-.999999?(vec3.cross(f,d,e),vec3.length(f)<1e-6&&vec3.cross(f,m,e),vec3.normalize(f,f),p.setAxisAngle(t,f,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(vec3.cross(f,e,r),t[0]=f[0],t[1]=f[1],t[2]=f[2],t[3]=1+i,p.normalize(t,t))}),p.setAxes=(v=mat3.create(),function(t,e,r,i){return v[0]=r[0],v[3]=r[1],v[6]=r[2],v[1]=i[0],v[4]=i[1],v[7]=i[2],v[2]=-e[0],v[5]=-e[1],v[8]=-e[2],p.normalize(t,p.fromMat3(t,v))}),p.clone=u.clone,p.fromValues=u.fromValues,p.copy=u.copy,p.set=u.set,p.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},p.setAxisAngle=function(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t},p.add=u.add,p.multiply=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],h=r[3];return t[0]=i*h+o*s+n*l-a*u,t[1]=n*h+o*u+a*s-i*l,t[2]=a*h+o*l+i*u-n*s,t[3]=o*h-i*s-n*u-a*l,t},p.mul=p.multiply,p.scale=u.scale,p.rotateX=function(t,e,r){r*=.5;var i=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=i*u+o*s,t[1]=n*u+a*s,t[2]=a*u-n*s,t[3]=o*u-i*s,t},p.rotateY=function(t,e,r){r*=.5;var i=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=i*u-a*s,t[1]=n*u+o*s,t[2]=a*u+i*s,t[3]=o*u-n*s,t},p.rotateZ=function(t,e,r){r*=.5;var i=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=i*u+n*s,t[1]=n*u-i*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t},p.calculateW=function(t,e){var r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t},p.dot=u.dot,p.lerp=u.lerp,p.slerp=function(t,e,r,i){var n,a,o,s,u,l=e[0],h=e[1],c=e[2],f=e[3],d=r[0],m=r[1],v=r[2],p=r[3];return(a=l*d+h*m+c*v+f*p)<0&&(a=-a,d=-d,m=-m,v=-v,p=-p),1-a>1e-6?(n=Math.acos(a),o=Math.sin(n),s=Math.sin((1-i)*n)/o,u=Math.sin(i*n)/o):(s=1-i,u=i),t[0]=s*l+u*d,t[1]=s*h+u*m,t[2]=s*c+u*v,t[3]=s*f+u*p,t},p.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=r*r+i*i+n*n+a*a,s=o?1/o:0;return t[0]=-r*s,t[1]=-i*s,t[2]=-n*s,t[3]=a*s,t},p.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},p.length=u.length,p.len=p.length,p.squaredLength=u.squaredLength,p.sqrLen=p.squaredLength,p.normalize=u.normalize,p.fromMat3=function(t,e){var r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*a+a]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*a+o]-e[3*o+a])*r,t[a]=(e[3*a+n]+e[3*n+a])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t},p.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==t&&(t.quat=p)}(f.exports);var m=l;e.default=m}}]);